<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>AGROCLIMA IS 71</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#1f2933;
  --accent:#2f855a;
}
body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --accent:#22c55e;
}

body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  transition: background 0.3s;
}

header{
  text-align:center;
  padding:30px 15px 10px;
  position:relative;
}

.logo-principal{
  width:140px;
  height:140px;
  border-radius:50%;
  object-fit:cover;
}

h1{margin:10px 0 5px;}
.slogan{font-style:italic;color:var(--accent);margin-bottom:20px;}

.menu-btn{
  position:absolute;
  top:20px;
  right:20px;
  font-size:28px;
  cursor:pointer;
  z-index:20;
}

.menu{
  position:fixed;
  top:0;
  right:-280px;
  width:260px;
  height:100%;
  background:var(--card);
  box-shadow:-5px 0 20px rgba(0,0,0,.3);
  padding:20px;
  transition:.3s;
  z-index:30;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
.menu.open{right:0}

.menu button {
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: white;
  cursor: pointer;
  font-weight: bold;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  z-index:25;
}
.overlay.show{display:block}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  padding:0 20px;
  max-width:1100px;
  margin:auto;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:25px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.value{font-size:32px;font-weight:bold}

.chart-box{
  background:var(--card);
  margin:40px auto;
  padding:25px;
  max-width:1100px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.chart-container{
  position:relative;
  height:360px;
  width:100%;
}

button.download{
  margin-top:15px;
  padding:10px 18px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}

/* MODAL DE CULTIVOS */
.modal-cultivos {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--card);
  padding: 30px;
  border-radius: 20px;
  z-index: 100;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
.modal-cultivos.show { display: block; }
.modal-cultivos h2 { color: var(--accent); margin-top: 0; }

footer{text-align:center;margin:40px 0}
.logo-efa{width:80px;opacity:.85}
</style>
</head>

<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<div id="cropModal" class="modal-cultivos">
    <h2 id="estacionTitulo">Estaci√≥n</h2>
    <p id="recomendacionTexto"></p>
    <button class="download" onclick="closeAll()">Cerrar</button>
</div>

<header>
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <img src="logo-agroclima2.png" class="logo-principal">
  <h1>AGROCLIMA IS 71</h1>
  <div class="slogan">El clima en tus manos</div>
</header>

<div class="menu" id="menu">
  <h3>Opciones</h3>
  <button onclick="toggleDark()">üåô Modo oscuro</button>
  <button onclick="showCrops()">üå± Cultivos recomendados</button>
</div>

<section class="cards">
  <div class="card"><h3>üå°Ô∏è Temperatura</h3><div class="value" id="temp">--</div></div>
  <div class="card"><h3>üíß Humedad</h3><div class="value" id="humidity">--</div></div>
  <div class="card"><h3>üí® Viento</h3><div class="value" id="wind">--</div></div>
  <div class="card"><h3>üåßÔ∏è Precipitaci√≥n</h3><div class="value" id="rain">--</div></div>
</section>

<div class="chart-box">
  <h2>Historial diario (√∫ltimos 30 d√≠as)</h2>
  <div class="chart-container">
    <canvas id="dailyChart"></canvas>
  </div>
  <button class="download" onclick="downloadChart(dailyChartInstance, 'diario')">Descargar PNG</button>
</div>

<div class="chart-box">
  <h2>Climograma mensual (A√±o 2026)</h2>
  <div class="chart-container">
    <canvas id="monthlyChart"></canvas>
  </div>
  <button class="download" onclick="downloadChart(monthlyChartInstance, 'mensual')">Descargar PNG</button>
</div>

<footer>
  <img src="logo-efa.png" class="logo-efa">
</footer>

<script>
const lat=-28.05, lon=-56.03;
let dailyChartInstance, monthlyChartInstance;

/* MENU Y CERRAR MODALES */
function toggleMenu(){
  document.getElementById("menu").classList.toggle("open");
  document.getElementById("overlay").classList.toggle("show");
}

function closeAll(){
  document.getElementById("menu").classList.remove("open");
  document.getElementById("cropModal").classList.remove("show");
  document.getElementById("overlay").classList.remove("show");
}

/* DARK MODE */
if(localStorage.dark==="1") document.body.classList.add("dark");
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.dark=document.body.classList.contains("dark")?"1":"0";
  location.reload(); 
}

/* RECOMENDACI√ìN DE CULTIVOS (NORTE DE CORRIENTES) */
function showCrops(){
  const mes = new Date().getMonth(); 
  let titulo = "";
  let texto = "";

  if(mes >= 11 || mes <= 1) { 
    titulo = "‚òÄÔ∏è Verano en Corrientes";
    texto = "Para Virasoro y zona: √âpoca de Sand√≠a, Mel√≥n, Zapallo y Poroto Caup√≠. ¬°Ojo! Usar media sombra para hortalizas de hoja debido al sol intenso.";
  } else if(mes >= 2 && mes <= 4) { 
    titulo = "üçÇ Oto√±o en Corrientes";
    texto = "¬°La mejor √©poca! Plantar Lechuga, Acelga, Remolacha y Cebolla de Verdeo. El clima es ideal, ni muy fr√≠o ni muy caliente.";
  } else if(mes >= 5 && mes <= 7) { 
    titulo = "‚ùÑÔ∏è Invierno en Corrientes";
    texto = "Plantar Zanahoria, Arvejas, Ajo y Br√≥coli. En San Carlos y Liebig cuidado con las heladas tard√≠as, proteger con telas t√©rmicas.";
  } else { 
    titulo = "üå∏ Primavera en Corrientes";
    texto = "Ideal para Mandioca (clave en la zona), Tomate, Pimiento y Berenjena. Inicia la √©poca de lluvias fuertes.";
  }

  document.getElementById("estacionTitulo").innerText = titulo;
  document.getElementById("recomendacionTexto").innerText = texto;
  document.getElementById("cropModal").classList.add("show");
  document.getElementById("overlay").classList.add("show");
}

/* DATOS ACTUALES */
fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,precipitation`)
.then(r=>r.json()).then(d=>{
  document.getElementById("temp").textContent=d.current.temperature_2m+" ¬∞C";
  document.getElementById("humidity").textContent=d.current.relative_humidity_2m+" %";
  document.getElementById("wind").textContent=d.current.wind_speed_10m+" km/h";
  document.getElementById("rain").textContent=d.current.precipitation+" mm";
});

const f=d=>d.toISOString().split("T")[0];
const today = new Date();
const startDaily = new Date(); startDaily.setDate(today.getDate()-30);

/* GRAFICO DIARIO */
fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${f(startDaily)}&end_date=${f(today)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=America/Argentina/Buenos_Aires`)
.then(r=>r.json()).then(d=>{
  const ctx = document.getElementById("dailyChart").getContext("2d");
  dailyChartInstance = new Chart(ctx,{
    data:{
      labels:d.daily.time,
      datasets:[
        {type:"line",label:"M√°x",data:d.daily.temperature_2m_max, borderColor:'#e53e3e', yAxisID:'y'},
        {type:"line",label:"M√≠n",data:d.daily.temperature_2m_min, borderColor:'#3182ce', yAxisID:'y'},
        {type:"bar",label:"Lluvia (mm)",data:d.daily.precipitation_sum, backgroundColor:'rgba(47, 133, 90, 0.5)', yAxisID:'y1'}
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      scales:{
        y:{type:'linear', position:'left', title:{display:true, text:'Temp ¬∞C'}},
        y1:{type:'linear', position:'right', grid:{drawOnChartArea:false}, title:{display:true, text:'Precipitaci√≥n mm'}}
      }
    }
  });
});

/* CLIMOGRAMA MENSUAL - A√ëO 2026 DIN√ÅMICO */
const meses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];
fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=2026-01-01&end_date=${f(today)}&daily=temperature_2m_mean,precipitation_sum&timezone=America/Argentina/Buenos_Aires`)
.then(r=>r.json()).then(d=>{
  const mensualTemp = new Array(12).fill(null);
  const mensualRain = new Array(12).fill(null);
  const sumTemp = new Array(12).fill(0);
  const sumRain = new Array(12).fill(0);
  const count = new Array(12).fill(0);

  d.daily.time.forEach((fecha, i) => {
    const mesIdx = new Date(fecha).getUTCMonth();
    sumTemp[mesIdx] += d.daily.temperature_2m_mean[i];
    sumRain[mesIdx] += d.daily.precipitation_sum[i];
    count[mesIdx]++;
  });

  for(let i=0; i<12; i++){
    if(count[i] > 0){
      mensualTemp[i] = (sumTemp[i] / count[i]).toFixed(1);
      mensualRain[i] = sumRain[i].toFixed(1);
    }
  }

  const ctx = document.getElementById("monthlyChart").getContext("2d");
  monthlyChartInstance = new Chart(ctx,{
    data:{
      labels:meses,
      datasets:[
        {type:"line", label:"Temp Media ¬∞C", data:mensualTemp, borderColor:'#ff9f43', backgroundColor:'#ff9f43', borderWidth:3, yAxisID:'yT'},
        {type:"bar", label:"Lluvia Total mm", data:mensualRain, backgroundColor:'#2f855a', yAxisID:'yR'}
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      scales: {
        yT: { type: 'linear', position: 'left', title: { display: true, text: 'Temperatura (¬∞C)' }},
        yR: { type: 'linear', position: 'right', title: { display: true, text: 'Lluvia (mm)' }, grid: { drawOnChartArea: false }}
      }
    }
  });
});

/* FUNCI√ìN DESCARGA */
function downloadChart(instance, nombre){
  if(!instance) return;
  const link = document.createElement('a');
  link.download = `agroclima-${nombre}.png`;
  link.href = instance.toDataURL("image/png");
  link.click();
}
</script>

</body>
</html>
