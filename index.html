<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>AGROCLIMA IS 71</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#1f2933;
  --accent:#2f855a;
}
body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --accent:#22c55e;
}

body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  text-align:center;
  padding:30px 15px 10px;
  position:relative;
}

.logo-principal{
  width:140px;
  height:140px;
  border-radius:50%;
  object-fit:cover;
}

h1{margin:10px 0 5px;}
.slogan{font-style:italic;color:var(--accent);margin-bottom:20px;}

.menu-btn{
  position:absolute;
  top:20px;
  right:20px;
  font-size:28px;
  cursor:pointer;
  z-index:20;
}

.menu{
  position:fixed;
  top:0;
  right:-260px;
  width:260px;
  height:100%;
  background:var(--card);
  box-shadow:-5px 0 20px rgba(0,0,0,.3);
  padding:20px;
  transition:.3s;
  z-index:30;
}
.menu.open{right:0}

.menu h3{margin-top:0}
.menu button{
  width:100%;
  margin:10px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  z-index:25;
}
.overlay.show{display:block}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  padding:0 20px;
  max-width:1100px;
  margin:auto;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:25px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.value{font-size:32px;font-weight:bold}

.chart-box{
  background:var(--card);
  margin:40px auto;
  padding:25px;
  max-width:1100px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  text-align:center;
}

canvas{max-width:100%}

button.download{
  margin-top:15px;
  padding:10px 18px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:white;
  cursor:pointer;
}

footer{text-align:center;margin:40px 0}
.logo-efa{width:80px;opacity:.85}
</style>
</head>

<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<header>
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <img src="logo-agroclima.png" class="logo-principal">
  <h1>AGROCLIMA IS 71</h1>
  <div class="slogan">El clima en tus manos</div>
</header>

<div class="menu" id="menu">
  <h3>Opciones</h3>
  <button onclick="toggleDark()">üåô Modo oscuro</button>
  <button onclick="showCrops()">üå± Cultivos recomendados</button>
</div>

<section class="cards">
  <div class="card"><h3>üå°Ô∏è Temperatura</h3><div class="value" id="temp">--</div></div>
  <div class="card"><h3>üíß Humedad</h3><div class="value" id="humidity">--</div></div>
  <div class="card"><h3>üí® Viento</h3><div class="value" id="wind">--</div></div>
  <div class="card"><h3>üåßÔ∏è Precipitaci√≥n</h3><div class="value" id="rain">--</div></div>
</section>

<div class="chart-box">
  <h2>Historial diario (√∫ltimos 30 d√≠as)</h2>
  <canvas id="dailyChart"></canvas>
  <button class="download" onclick="downloadChart(dailyChart)">Descargar PNG</button>
</div>

<div class="chart-box">
  <h2>Climograma mensual</h2>
  <canvas id="monthlyChart"></canvas>
  <button class="download" onclick="downloadChart(monthlyChart)">Descargar PNG</button>
</div>

<footer>
  <img src="logo-efa.png" class="logo-efa">
</footer>

<script>
const lat=-28.05, lon=-56.03;

/* MENU */
function toggleMenu(){
  menu.classList.toggle("open");
  overlay.classList.toggle("show");
}

/* DARK MODE */
if(localStorage.dark==="1") document.body.classList.add("dark");
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.dark=document.body.classList.contains("dark")?"1":"0";
}

/* CULTIVOS */
function showCrops(){
  const m=new Date().getMonth()+1;
  let est="Invierno", crops=["Lechuga","Acelga","Cebolla","Repollo"];
  if(m>=9&&m<=11){est="Primavera";crops=["Ma√≠z","Zapallo","Tomate","Poroto"];}
  if(m>=12||m<=2){est="Verano";crops=["Arroz","Sand√≠a","Mel√≥n","Ma√≠z tard√≠o"];}
  if(m>=3&&m<=5){est="Oto√±o";crops=["Papa","Zanahoria","Arveja","Ajo"];}
  alert("üìç Corrientes\nüçÉ "+est+"\n\nüå± Cultivos:\n- "+crops.join("\n- "));
}

/* DATOS ACTUALES */
fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,precipitation`)
.then(r=>r.json()).then(d=>{
  temp.textContent=d.current.temperature_2m+" ¬∞C";
  humidity.textContent=d.current.relative_humidity_2m+" %";
  wind.textContent=d.current.wind_speed_10m+" km/h";
  rain.textContent=d.current.precipitation+" mm";
});

/* FECHAS */
const end=new Date(), start=new Date();
start.setDate(end.getDate()-30);
const f=d=>d.toISOString().split("T")[0];

/* GRAFICO DIARIO */
let dailyChart;
fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${f(start)}&end_date=${f(end)}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=America/Argentina/Buenos_Aires`)
.then(r=>r.json()).then(d=>{
  dailyChart=new Chart(document.getElementById("dailyChart"),{
    data:{
      labels:d.daily.time,
      datasets:[
        {type:"line",label:"Temp M√°x",data:d.daily.temperature_2m_max,tension:.4},
        {type:"line",label:"Temp M√≠n",data:d.daily.temperature_2m_min,tension:.4},
        {type:"bar",label:"Precipitaci√≥n",data:d.daily.precipitation_sum}
      ]
    },
    options:{responsive:true}
  });
});

/* CLIMOGRAMA (ENERO CORREGIDO) */
let monthlyChart;
const meses=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];

fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${end.getFullYear()}-01-01&end_date=${end.getFullYear()}-12-31&monthly=temperature_2m_mean,precipitation_sum&timezone=America/Argentina/Buenos_Aires`)
.then(r=>r.json()).then(d=>{
  monthlyChart=new Chart(document.getElementById("monthlyChart"),{
    data:{
      labels:meses,
      datasets:[
        {
          type:"line",
          label:"Temp Media",
          data:d.monthly.temperature_2m_mean,
          tension:.4
        },
        {
          type:"bar",
          label:"Precipitaci√≥n",
          data:d.monthly.precipitation_sum
        }
      ]
    },
    options:{responsive:true}
  });
});

/* DESCARGA */
function downloadChart(chart){
  const a=document.createElement("a");
  a.href=chart.toBase64Image();
  a.download="grafico-agroclima.png";
  a.click();
}
</script>

</body>
</html>


